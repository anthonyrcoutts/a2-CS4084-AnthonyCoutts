<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>

<body>
    <div>
        <button onclick="location.href='index.html'">
            Static Visualization
        </button>

        <button onclick="location.href='scatterrug.html'">
            Enhanced Visualization
        </button>
    </div>

    <svg id="graph"></svg>


    <script>

        // Specify the chartâ€™s dimensions.
        const width = 928;
        const height = 600;
        const marginTop = 20;
        const marginRight = 150;
        const marginBottom = 150;
        const marginLeft = 150;

        // Create the SVG container.
        const svg = d3.select("#graph")
            .attr("viewBox", [0, 0, width, height])
            .style("width", "80%")
            .style("height", "80%");



        d3.csv("penglings.csv", d3.autoType).then(data => {

            const cleanData = data.filter(d =>
                d.flipper_length_mm != null &&
                d.body_mass_g != null
            );

            // Filter data by species for click events and rugs
            const adelieData = cleanData.filter(d =>
                d.species == "Adelie"
            );

            const gentooData = cleanData.filter(d =>
                d.species == "Gentoo"
            );

            const chinstrapData = cleanData.filter(d =>
                d.species == "Chinstrap"
            );

            // Create the horizontal (x) scale, positioning N/A values on the left margin.
            const x = d3.scaleLinear()
                .domain([d3.min(cleanData, d => d["flipper_length_mm"]) - 5, d3.max(cleanData, d => d["flipper_length_mm"]) + 5])
                .range([marginLeft, width - marginRight])

            // Create the vertical (y) scale, positioning N/A values on the bottom margin.
            const y = d3.scaleLinear()
                .domain([d3.min(cleanData, d => d["body_mass_g"]) - 150, d3.max(cleanData, d => d["body_mass_g"]) + 150])
                .range([height - marginBottom, marginTop])

            // Shape scale
            const r = d3.scaleRadial()
                .domain([d3.min(cleanData, d => d["bill_length_mm"]), d3.max(cleanData, d => d["bill_length_mm"])])
                .range([2, 6])

            // Color pallete
            const species = Array.from(
                new Set(cleanData.map(d => d.species))
            );

            const color = d3.scaleOrdinal()
                .domain(species)
                .range(["#E5BA41", "#ec102f", "#2e8190"]);


            // Append the axes.
            svg.append("g")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .call(d3.axisBottom(x))
                .call(g => g.append("text")
                    .attr("x", width / 2)
                    .attr("y", marginBottom - 20)
                    .attr("fill", "currentColor")
                    .attr("text-anchor", "middle")
                    .text("Flipper Length (mm)"));


            svg.append("g")
                .attr("transform", `translate(${marginLeft},0)`)
                .call(d3.axisLeft(y))
                .call(g => g.append("text")
                    .attr("fill", "currentColor")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -height / 2.5)
                    .attr("y", -marginLeft + 12)
                    .attr("text-anchor", "middle")
                    .text("Body Mass (g)")
                );


            // Species highlight function
            let activeSpecies = null;

            function highlightSpecies(selected) {

                // Turn off if clicking same species
                if (selected === null) {
                    activeSpecies = null;

                    svg.selectAll(".dot-circle")
                        .transition()
                        .duration(200)
                        .attr("fill-opacity", 0.7);

                    svg.selectAll(".dot-rug")
                        .transition()
                        .duration(200)
                        .attr("stroke-opacity", 0.7);

                    return;
                }

                // Otherwise activateSpecies is the selected
                activeSpecies = selected;

                // CHange opacity of everything
                svg.selectAll(".dot-circle")
                    .transition()
                    .duration(200)
                    .attr("fill-opacity", 0.1);

                svg.selectAll(".dot-rug")
                    .transition()
                    .duration(200)
                    .attr("stroke-opacity", 0.1);

                // Highlight selected species
                svg.selectAll(".dot-circle")
                    .filter(d => d.species === selected)
                    .transition()
                    .duration(200)
                    .attr("fill-opacity", 1);

                svg.selectAll(".dot-rug")
                    .filter(d => d.species === selected)
                    .transition()
                    .duration(200)
                    .attr("stroke-opacity", 1);
            }

            // Legend color
            const legend = svg.append("g")
                .attr("transform", `translate(${width - 120},${height / 2})`);

            const legendItem = legend.selectAll(".legend-item")
                .data(species)
                .join("g")
                .attr("class", "legend-item")
                .attr("transform", (d, i) => `translate(0, ${i * 20})`);


            legendItem.append("circle")
                .attr("r", 6)
                .attr("cx", 0)
                .attr("cy", 0)
                .attr("fill", d => color(d))
                .style("cursor", "pointer")
                .on("click", (event, d) => {
                    event.stopPropagation();
                    highlightSpecies(d);
                });


            legendItem.append("text")
                .attr("x", 12)
                .attr("y", 4)
                .text(d => d);

            legend.append("text")
                .attr("y", -20)
                .attr("font-weight", "bold")
                .text("species");

            // Size legend
            const sizeLegendValues = [40, 50];

            const sizeLegend = svg.append("g")
                .attr("transform", `translate(${width - 120},${(height / 2) - 100})`);

            const sizeItem = sizeLegend.selectAll(".size-item")
                .data(sizeLegendValues)
                .join("g")
                .attr("class", "size-item")
                .attr("transform", (d, i) => `translate(0, ${i * 30})`);

            sizeItem.append("circle")
                .attr("r", d => r(d))
                .attr("cx", 0)
                .attr("cy", 0)
                .attr("fill", "black")
                .attr("stroke", "black");

            sizeItem.append("text")
                .attr("x", d => r(d) + 6)
                .attr("y", 4)
                .text(d => `${d}`);

            sizeLegend.append("text")
                .attr("y", -20)
                .attr("font-weight", "bold")
                .text("bill_length_mm");

            // Background rectangle for species selection reset 
            svg.append("rect")
                .attr("width", width)
                .attr("height", height)
                .attr("fill", "transparent")
                .lower()
                .on("click", () => {
                    highlightSpecies(null);
                });


            // Append the dots.
            const dots = svg.append("g")
                .selectAll("circle")
                .data(cleanData)
                .join("circle")
                .attr("class", "dot-circle")
                .attr("fill", d => color(d.species))
                .attr("cx", d => x(d.flipper_length_mm))
                .attr("cy", d => y(d.body_mass_g))
                .attr("r", d => r(d.bill_length_mm))
                .attr("fill-opacity", 0.7)
                .style("cursor", "pointer")
                .on("click", (event, d) => {
                    highlightSpecies(d.species);
                });

            // Append rug rectangles
            svg.append("rect")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .attr("x", marginLeft)
                .attr("y", marginBottom - 120)
                .attr("width", width - marginLeft - marginRight)
                .attr("height", 75)
                .attr("fill", "transparent")
                .attr("stroke", "black");

            svg.append("rect")
                .attr("transform", `translate(${marginLeft},0)`)
                .attr("x", -marginLeft + 30)
                .attr("y", marginTop)
                .attr("width", 75)
                .attr("height", height - marginBottom - marginTop)
                .attr("fill", "transparent")
                .attr("stroke", "black");


            // Append X rugs in boxes
            const rugXAdelie = svg.append("g")
                .selectAll("line")
                .data(adelieData)
                .join("line")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .attr("class", "dot-rug")
                .attr("x1", d => x(d.flipper_length_mm))
                .attr("x2", d => x(d.flipper_length_mm))
                .attr("y1", marginBottom - 47.5)
                .attr("y2", marginBottom - 67.5)
                .attr("stroke", d => color(d.species))
                .style("cursor", "pointer")
                .on("click", (event, d) => {
                    highlightSpecies(d.species);
                });

            const rugXChinstrap = svg.append("g")
                .selectAll("line")
                .data(chinstrapData)
                .join("line")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .attr("class", "dot-rug")
                .attr("x1", d => x(d.flipper_length_mm))
                .attr("x2", d => x(d.flipper_length_mm))
                .attr("y1", marginBottom - 72.5)
                .attr("y2", marginBottom - 92.5)
                .attr("stroke", d => color(d.species))
                .style("cursor", "pointer")
                .on("click", (event, d) => {
                    highlightSpecies(d.species);
                });

            const rugXGentoo = svg.append("g")
                .selectAll("line")
                .data(gentooData)
                .join("line")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .attr("x1", d => x(d.flipper_length_mm))
                .attr("x2", d => x(d.flipper_length_mm))
                .attr("y1", marginBottom - 97.5)
                .attr("y2", marginBottom - 117.5)
                .style("cursor", "pointer")
                .attr("class", "dot-rug")
                .attr("stroke", d => color(d.species))
                .on("click", (event, d) => {
                    highlightSpecies(d.species);
                });

            // Append Y rugs in boxes
            const rugYAdelie = svg.append("g")
                .selectAll("line")
                .data(adelieData)
                .join("line")
                .attr("transform", `translate(${marginLeft},0)`)
                .attr("x1", -marginLeft + 32.5)
                .attr("x2", -marginLeft + 52.5)
                .attr("y1", d => y(d.body_mass_g))
                .attr("y2", d => y(d.body_mass_g))
                .style("cursor", "pointer")
                .attr("class", "dot-rug")
                .attr("stroke", d => color(d.species))
                .on("click", (event, d) => {
                    highlightSpecies(d.species);
                });

            const rugYChinstrap = svg.append("g")
                .selectAll("line")
                .data(chinstrapData)
                .join("line")
                .attr("transform", `translate(${marginLeft},0)`)
                .attr("x1", -marginLeft + 57.5)
                .attr("x2", -marginLeft + 77.5)
                .attr("y1", d => y(d.body_mass_g))
                .attr("y2", d => y(d.body_mass_g))
                .style("cursor", "pointer")
                .attr("class", "dot-rug")
                .attr("stroke", d => color(d.species))
                .on("click", (event, d) => {
                    highlightSpecies(d.species);
                });

            const rugYGentoo = svg.append("g")
                .selectAll("line")
                .data(gentooData)
                .join("line")
                .attr("transform", `translate(${marginLeft},0)`)
                .attr("x1", -marginLeft + 82.5)
                .attr("x2", -marginLeft + 102.5)
                .attr("y1", d => y(d.body_mass_g))
                .attr("y2", d => y(d.body_mass_g))
                .style("cursor", "pointer")
                .attr("class", "dot-rug")
                .attr("stroke", d => color(d.species))
                .on("click", (event, d) => {
                    highlightSpecies(d.species);
                });


        });

    </script>





</body>

</html>